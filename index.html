<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ImperialPredict</title>
    <style>
        /* --- CSS STYLES (The Skin) --- */
        :root { --imperial-blue: #000080; --light-gray: #f4f4f4; --success-green: #2ecc71; }
        body { font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif; background-color: var(--light-gray); margin: 0; padding: 20px; color: #333; }
        .container { max-width: 800px; margin: 0 auto; padding-bottom: 50px; }
        
        /* Sticky Header */
        .sticky-header {
            background: var(--imperial-blue); color: white; padding: 20px;
            border-radius: 12px; margin-bottom: 24px; text-align: center;
            box-shadow: 0 4px 12px rgba(0,0,0,0.15);
            position: sticky; top: 10px; z-index: 100;
        }
        .header-title { margin: 0; font-size: 1.5em; font-weight: 700; }
        .header-subtitle { margin: 5px 0 0 0; opacity: 0.9; font-size: 0.9em; }
        #year-average { font-weight: bold; font-size: 1.2em; color: #fff; }

        /* Module Cards */
        .module-card {
            background: white; padding: 20px; border-radius: 12px;
            margin-bottom: 16px; box-shadow: 0 2px 4px rgba(0,0,0,0.05);
            transition: transform 0.2s ease;
        }
        .module-header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 15px; padding-bottom: 10px; border-bottom: 2px solid #f0f0f0; }
        .module-title { font-weight: 700; font-size: 1.1em; color: var(--imperial-blue); }
        .module-grade { font-weight: bold; font-size: 1.1em; color: #555; background: #eee; padding: 4px 8px; border-radius: 6px; }
        
        /* Task Rows */
        .task-row {
            display: flex; justify-content: space-between; align-items: center;
            padding: 10px 0; border-bottom: 1px solid #f9f9f9;
        }
        .task-info { display: flex; flex-direction: column; }
        .task-name { font-size: 0.95em; color: #444; }
        .task-meta { font-size: 0.8em; color: #888; margin-top: 2px; }
        
        .task-input-group { display: flex; align-items: center; gap: 10px; }
        .task-input { 
            width: 70px; padding: 8px; border: 1px solid #ddd; border-radius: 6px; 
            text-align: center; font-size: 1em; font-weight: bold; color: var(--imperial-blue);
        }
        .task-input:focus { outline: none; border-color: var(--imperial-blue); background: #f0f8ff; }
        .task-percentage { font-size: 0.9em; color: #888; }
        
        /* Utility */
        .loading { text-align: center; padding: 40px; color: #666; font-style: italic; }
        .error { color: red; text-align: center; padding: 20px; background: white; border-radius: 8px; }
    </style>
</head>
<body>

    <div class="container">
        <!-- Header -->
        <div class="sticky-header">
            <h1 class="header-title">ImperialPredict</h1>
            <p class="header-subtitle">
                <span id="course-name">Loading Course...</span> • 
                Year Average: <span id="year-average">--%</span>
            </p>
        </div>

        <!-- App Container -->
        <div id="app">
            <div class="loading">Loading module data...</div>
        </div>
    </div>

    <!-- --- JAVASCRIPT LOGIC (The Engine) --- -->
    <script>
        // 1. CONSTANTS & STATE
        const DATA_FILE = 'imperial_computing_y1.json';
        let courseData = null;

        // 2. INITIALIZATION
        document.addEventListener('DOMContentLoaded', () => {
            fetchData();
        });

        // 3. FETCH DATA
        async function fetchData() {
            try {
                const response = await fetch(DATA_FILE);
                if (!response.ok) throw new Error("Could not find data file");
                courseData = await response.json();
                renderApp();
            } catch (error) {
                document.getElementById('app').innerHTML = `
                    <div class="error">
                        <h3>Error Loading Data</h3>
                        <p>Make sure <code>${DATA_FILE}</code> is in your GitHub repository.</p>
                        <p>Details: ${error.message}</p>
                    </div>`;
            }
        }

        // 4. RENDER UI
        function renderApp() {
            const app = document.getElementById('app');
            const yearAverageEl = document.getElementById('year-average');
            const courseNameEl = document.getElementById('course-name');

            // Set Header Info
            courseNameEl.textContent = courseData.courseName;
            app.innerHTML = ''; // Clear loading message

            // Loop through modules and create cards
            courseData.modules.forEach((module, moduleIndex) => {
                const card = document.createElement('div');
                card.className = 'module-card';
                
                // Build HTML for tasks
                let tasksHtml = '';
                module.tasks.forEach((task, taskIndex) => {
                    // Convert decimal weight (0.04) to percentage string (4%)
                    const weightPct = Math.round(task.weight * 100) + '%';
                    
                    tasksHtml += `
                        <div class="task-row">
                            <div class="task-info">
                                <span class="task-name">${task.name}</span>
                                <span class="task-meta">${task.date} • Weight: ${weightPct}</span>
                            </div>
                            <div class="task-input-group">
                                <input 
                                    type="number" 
                                    class="task-input" 
                                    placeholder="-" 
                                    min="0" 
                                    max="${task.maxScore}" 
                                    data-module-index="${moduleIndex}" 
                                    data-task-index="${taskIndex}"
                                    oninput="calculateGrades()"
                                >
                                <span class="task-percentage">/ ${task.maxScore}</span>
                            </div>
                        </div>
                    `;
                });

                // Assemble Card
                card.innerHTML = `
                    <div class="module-header">
                        <span class="module-title">${module.id} - ${module.name}</span>
                        <span class="module-grade" id="grade-${moduleIndex}">0%</span>
                    </div>
                    <div class="module-tasks">
                        ${tasksHtml}
                    </div>
                `;
                app.appendChild(card);
            });
        }

        // 5. CALCULATION ENGINE
        function calculateGrades() {
            let totalYearScore = 0;
            // Note: Since we removed 'credits', we assume equal weighting for modules 
            // OR we calculate based on the sum of all module weights if they differ. 
            // For now, let's calculate the simple average of all modules 
            // since specific module weighting wasn't in the simplified JSON. 
            // (We can refine this if you add module weights later).
            
            let moduleCount = courseData.modules.length;

            courseData.modules.forEach((module, moduleIndex) => {
                let currentModuleScore = 0;
                let currentModuleWeightUsed = 0;

                // Loop through all inputs for this module
                module.tasks.forEach((task, taskIndex) => {
                    // Find the specific input box
                    const input = document.querySelector(`input[data-module-index="${moduleIndex}"][data-task-index="${taskIndex}"]`);
                    const val = parseFloat(input.value);

                    if (!isNaN(val)) {
                        // Normalize to percentage (val / maxScore)
                        const percentage = val / task.maxScore;
                        
                        // Add to module total (Percentage * Weight)
                        // Example: 70% * 0.4 weight = 0.28 contribution
                        // We multiply by 100 to keep it in readable numbers (28 points)
                        currentModuleScore += (percentage * task.weight * 100);
                        currentModuleWeightUsed += task.weight;
                    }
                });

                // Update Module Badge
                // Logic: If they have only done 10% of the course, do we show 70% average or 7% total?
                // "Predicting" usually means raw accumulation. 
                // Let's show the raw accumulation (what they have banked so far).
                const gradeBadge = document.getElementById(`grade-${moduleIndex}`);
                gradeBadge.textContent = currentModuleScore.toFixed(1) + '%';
                
                // Color coding
                if (currentModuleScore >= 70) { gradeBadge.style.color = '#2ecc71'; gradeBadge.style.background = '#e8f8f5'; } // First
                else if (currentModuleScore >= 60) { gradeBadge.style.color = '#f1c40f'; gradeBadge.style.background = '#fef9e7'; } // 2:1
                else { gradeBadge.style.color = '#555'; gradeBadge.style.background = '#eee'; }

                totalYearScore += currentModuleScore;
            });

            // Update Year Average
            // Simple Average across modules for now
            const finalAverage = totalYearScore / moduleCount;
            document.getElementById('year-average').textContent = finalAverage.toFixed(2) + '%';
        }
    </script>
</body>
</html>
